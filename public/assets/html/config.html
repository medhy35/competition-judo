<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Param√®tres ‚Äì Judo Comp√©tition</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
</head>
<body class="bg-light">

<div class="container py-4">
    <h2 class="mb-4 text-center">‚öôÔ∏è Configuration G√©n√©rale</h2>

    <form id="configForm" class="row g-3">
        <div class="col-md-4">
            <label class="form-label">Points Ippon</label>
            <input type="number" class="form-control" name="points.ippon" />
        </div>
        <div class="col-md-4">
            <label class="form-label">Points Wazari</label>
            <input type="number" class="form-control" name="points.wazari" />
        </div>
        <div class="col-md-4">
            <label class="form-label">Points Shido</label>
            <input type="number" class="form-control" name="points.shido" />
        </div>

        <div class="col-md-4">
            <label class="form-label">Dur√©e Combat (secondes)</label>
            <input type="number" class="form-control" name="combat.duree" />
        </div>

        <div class="col-md-4">
            <label class="form-label">Nombre Tatamis</label>
            <input type="number" class="form-control" name="combat.tatamis" />
        </div>

        <div class="col-md-4">
            <label class="form-label">Activer le Rep√™chage</label>
            <select class="form-select" name="options.repechage">
                <option value="true">Oui</option>
                <option value="false">Non</option>
            </select>
        </div>

        <div class="col-12 d-flex justify-content-center mt-3">
            <button type="submit" class="btn btn-success me-2"><i class="fa-solid fa-save"></i> Sauvegarder</button>
            <button type="button" class="btn btn-secondary" onclick="resetConfig()"><i class="fa-solid fa-rotate-left"></i> R√©initialiser</button>
        </div>
    </form>

    <hr class="mt-5" />
    <p class="text-center text-muted">Param√®tres de la comp√©tition stock√©s localement</p>
</div>

<script type="module">
    import Config from '../js/config/config.js';

    const form = document.getElementById("configForm");

    // üì• Charger valeurs existantes
    function chargerFormulaire() {
        const config = Config.get();
        for (const input of form.elements) {
            if (input.name && input.name.includes('.')) {
                const [cat, key] = input.name.split('.');
                const value = config[cat]?.[key];
                if (value !== undefined) input.value = value;
            }
        }
    }

    // üíæ Sauvegarder
    form.addEventListener("submit", (e) => {
        e.preventDefault();
        const newConfig = structuredClone(Config.get());

        for (const input of form.elements) {
            if (input.name && input.name.includes('.')) {
                const [cat, key] = input.name.split('.');
                if (!newConfig[cat]) newConfig[cat] = {};
                newConfig[cat][key] = input.type === "number" ? parseInt(input.value) : input.value === "true";
            }
        }

        Config.set(newConfig);
        alert("‚úÖ Configuration sauvegard√©e !");
    });

    // üîÅ R√©initialiser
    window.resetConfig = function () {
        if (!confirm("Remettre la configuration par d√©faut ?")) return;
        Config.reset();
        chargerFormulaire();
        alert("üîÑ Configuration r√©initialis√©e.");
    };

    // Init
    chargerFormulaire();
</script>

</body>
</html>
